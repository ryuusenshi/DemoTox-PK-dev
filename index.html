<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="javascripts/vector.js"></script>
    <script src="javascripts/ODE.js"></script>
	<script>
//pseudocode
/*
  1.Grab the accordion buttons from the DOM
  2. go through each accordion button one by one
  3. Use the classlist dom method in combination with the toggle method provided by the DOM to add or remove the "is-open" class. At this point, the accordion button should be able to switch back and forth between its font awesome icons but there is no content inside of it. This is because of the overflow:hidden and the max-height of zero; it is hiding our content. So now we must use javascript to change these values with DOM CSS
  4. get the div that has the content of the accordion button you are currently looking at; we do this using the .nextElementSibling method which allows us to look at the html element that is directly next to the current html element we are looking at. Since we are currently looking at a button (accordion button), the next element after that is the div with the class accordion-content. This is exactly what we want because it allows us to work with the div that has the content that we want to display. Also please note that we could have got to this div in another way but this is the "shortest path" to our answer.
  
  5. set the max-height based on whether the current value of the max-height css property. If the max-height is currently 0 (if the page has just been visited for the first time) or null (if it has been toggled once already) which means that it is closed, you will give it an actual value so the content will be shown; if not then that means the max-height currently has a value and you can set it back to null to close it.
  6. If the accordion is closed we set the max-height of the currently hidden text inside the accordion from 0 to the scroll height of the content inside the accordion. The scroll height refers to the height of an html element in pixels. For this specific example, we are talking about the height of the div with the class accordion-content with all of its nested ptags
*/

	</script>
   <script>
            ka = 1;
            ke = function(t) {
                return 0.1;
            };
            Td = 4;
            Dose = 40;
            Vmax = 100;
            km = 1000;
            ke_m = 0.5;
            F = 1;
            Vd = 1;
            isIVDose = false;

            var V = function(t, pt) {
                if (!isIVDose) {
                    if ((t%Td < 0.01) || ((Td - t%Td) < 0.01)) {
                        let doseNumber = Math.round(t/Td) + 1;

                        if (document.getElementById('dose' + doseNumber).checked) {
                            pt[0] = F/Vd*Dose;
                        } else {
                            pt[0] = 0;
                        }
                    }
                } else {
                    // IV bolus
                    if ((t%Td < 0.01) || ((Td - t%Td) < 0.01)) {
                        let doseNumber = Math.round(t/Td) + 1;

                        if (document.getElementById('dose' + doseNumber).checked) {
                            pt[1] = pt[1] + F/Vd*Dose;
                        }
                    }
                }


                var Ca = pt[0], Cx= pt[1], Cm = pt[2];
                // return [-ka*Ca, ka*Ca - ke(t)*Cx, Vmax*Cx/(km+Cx) - ke_m*Cm];
                
                return [-ka*Ca, ka*Ca - ke(t)*Cx - Vmax*Cx/(km + Cx), Vmax*Cx/(km + Cx) - ke_m*Cm];
            }

            var ode_ = new ODE(V);

            function resolve(results, i) {
                var c = [];

                for (var j=0; j<noPoints; j++) {
                    c[j] = results["pts"][j][i];
                }

                return c;
            }

            function solve() {
                results = ode_.solve(noPoints, step, 0, [0, 0, 0]);

                for (var j=0; j<noPoints; j++) {
                 if (results["pts"][j][0] > 1000 || results["pts"][j][0] < -1000 || results["pts"][j][1] > 1000 || results["pts"][j][1] < -1000) {
                    alert("System of differential equations has become numerically unstable, due to last parameter change, and the solution might not make sense. Please change back the parameter, select one of the IDILI hypothesese, or start over."); break;
                 };
                }

                return [resolve(results, 1), resolve(results, 2)];
            }
   </script>
 
<style>
@media print {
   .noprint {
      visibility: hidden;
   }
}

@page { size: auto;  margin-top: 0mm; margin-bottom: 0mm; }

.contflex {
  display: flex;
}
.contflex.space-around {
  justify-content: space-around;
}

/* begin tooltip */
.help-tip{
    position: absolute;
    top: 5px;
    right: 18px;
    text-align: center;
    background-color: #BCDBEA;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 14px;
    line-height: 26px;
    cursor: default;
}

.help-tip:before{
    content:'?';
    font-weight: bold;
    color:#fff;
}

.help-tip:hover p{
    display:block;
    transform-origin: 100% 0%;

    -webkit-animation: fadeIn 0.3s ease-in-out;
    animation: fadeIn 0.3s ease-in-out;

}

.help-tip p{    /* The tooltip */
    display: none;
    text-align: left;
    background-color: #1E2021;
    padding: 20px;
    width: 300px;
    position: absolute;
    border-radius: 3px;
    box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
    left: 30px;
    color: #FFF;
    font-size: 13px;
    line-height: 1.4;
	top: -34px;
}

/*.help-tip p:before{ /* The pointer of the tooltip */
    position: absolute;
    content: '';
    width:0;
    height: 0;
    border:6px solid transparent;
    border-bottom-color:#1E2021;
    right:10px;
    top:-12px;
}*/

.help-tip p:after{ /* Prevents the tooltip from being hidden */
    width:100%;
    height:40px;
    content:'';
    position: absolute;
    top:-40px;
    left:0;
}

/* CSS animation */

@-webkit-keyframes fadeIn {
    0% { 
        opacity:0; 
        transform: scale(0.6);
    }

    100% {
        opacity:100%;
        transform: scale(1);
    }
}

@keyframes fadeIn {
    0% { opacity:0; }
    100% { opacity:100%; }
}

/* end tooltip */

/* body {
  background-color: #6DC4F4;
}h1 { 
     color:white;
 
} */

body {
    font-size: 28px;
    font-family: sans-serif;    
}

input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 30px;
    width: 30px;
    border-radius: 100px;
    background: #0000FF;
    cursor: pointer;
    border: none;
}

input[type=range]:disabled::-webkit-slider-thumb {
    background: #DDDDDD;
}


input[type=range] {
    -webkit-appearance: none;
    outline: 0;
    margin: 0;
    padding: 0;
    height: 25px;
    width: 320px;
    border-radius:100px;
    background: #aaaaaa;
    border-color: #000000;`

}

input[type=range]:disabled {
    background: #DDDDDD;
}



input[type="number" i] {
    font-size: 28px;
    width: 100px;
}

select {
	height: 32px;
	font-size: 20px;
	font-weight: bold;
}

.container {
  width: 98%;
  max-width: 860px;
  margin: 0px auto;
}

button.accordion {
  width: 100%;
  background-color: whitesmoke;
  border: none;
  outline: none;
  text-align: left;
  padding: 15px 20px;
  font-size: 45px;
  color: #333;
  cursor: pointer;
  transition: background-color 0.2s linear;
}

button.accordion:after {
  font-family: FontAwesome;
  content: "\f150";
  font-family: "fontawesome";
  font-size: 40px;
  float: right;
}

button.accordion.is-open:after {
  content: "\f151";
}

button.accordion:hover,
button.accordion.is-open {
  background-color: #ddd;
}

.accordion-content {
  background-color: white;
  border-left: 1px solid whitesmoke;
  border-right: 1px solid whitesmoke;
  padding: 0 20px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.2s ease-in-out;
}
</style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script>
  	
  	function set(name, e, t) {
        document.getElementById(name + t).value = e.value;
        //updateData();
        delayedUpdateData_total();
		document.getElementById('idiliScenarios').value = 'sc_custom';
        //console.log(name, t);
    }

  function variableThreshold(high, scale) {

	const normalY = (x, mean, stdDev) => Math.exp((-0.5) * Math.pow((x - mean) / stdDev, 2));

	function range(lBound, uBound) {return Array.from(new Array(uBound-lBound), (x, i) => i + lBound);}


	const getMean = (lowerBound, upperBound) => (upperBound + lowerBound) / 2;

	// distance between mean and each bound of a 95% confidence interval
	// is 2 stdDeviation, so distance between the bounds is 4
	const getStdDeviation = (lowerBound, upperBound) => (upperBound - lowerBound) / 4;


	const generatePoints = (lowerBound, upperBound) => {
	  let stdDev = getStdDeviation(lowerBound, upperBound);
	  let min = lowerBound - 2 * stdDev;
	  let max = upperBound + 2 * stdDev;
	  let unit = max - min / 100;
	  return range(min, max, unit);
	}


	 

	const generateBellCurve = (upperBound, randomScale, constantScale, parameterScale) => {
		let lowerBound = 0;
		let mean = getMean(lowerBound, upperBound);
		let stdDev = getStdDeviation(lowerBound, upperBound);
		let points = generatePoints(lowerBound, upperBound);

		let seriesData = points.map(x => ({ x, y: normalY(x, mean, stdDev)}));



		return seriesData.map(p => ({y: -randomScale*constantScale*parameterScale*p['y']}))
	}

	let d = [];
	for (i=0; i<noPoints; i++) {
		d[i] = high;
	}


	function addBellCurve(curve, start, width, high, baseDepth, scaleDepth) {
		let bc = generateBellCurve(width/2, baseDepth, high*0.1, scaleDepth);
		for (j=start; j<start+width; j++) {
			d[j] = d[j] + bc[j-start]['y'];
		}
	}

	addBellCurve(d, 10, 40, high, 0.9, scale);
	addBellCurve(d, 70, 16, high, 1.3, scale);
	addBellCurve(d, 120, 60, high, 1.9, scale);
	addBellCurve(d, 200, 44, high, 2.5, scale);
	addBellCurve(d, 270, 30, high, 0.9, scale);
	addBellCurve(d, 320, 40, high, 0.9, scale);

	return d;
  }
    
  function imm_injury(t, h, l, t0, t1) {
     if (t<=t0) {
         return h;
     } else if (t<=t1) {
         return h-(h-l)*(t-t0)/(t1-t0);
     } else {
         return l;
     }
	}
 
  function regular(t, h, l, t0, t1) {
  	return h;
  }

  function var_curve(t, h, l, t0, t1) {
      return variableThreshold(parseFloat(h), parseFloat(l))[parseInt(t/step)];
  }

  function adapted_curve(t, h, l, t0, t1) {
		let t_onset = 25;
		if (t<t_onset) {
			return h;
		} else {
			return parseFloat(h)+30*(t-t_onset)/(4+t-t_onset);
		}
  }

  
  var curve_f = regular;
  
  function changeCurve(name) {
  	if (name == "regular" || name=="adaptation") {
		document.getElementById('lowNumber').style.visibility = 'hidden';
		document.getElementById('lowRange').style.visibility = 'hidden';
        document.getElementById('t0Number').style.visibility = 'hidden';
        document.getElementById('t0Range').style.visibility = 'hidden';
        document.getElementById('t1Number').style.visibility = 'hidden';
        document.getElementById('t1Range').style.visibility = 'hidden';
        document.getElementById('lowLabel').style.visibility = 'hidden';
        document.getElementById('t0Container').style.visibility = 'hidden';
        document.getElementById('t1Container').style.visibility = 'hidden';
 
        document.getElementById('lowLabel').innerHTML = 'value at time=t2:'; 
   
		document.getElementById('lowNumber').setAttribute('min', 0);
		document.getElementById('lowNumber').setAttribute('max', 180);
		document.getElementById('lowNumber').setAttribute('step', 70);
		document.getElementById('lowNumber').setAttribute('value', 1);
		document.getElementById('lowNumber').value = 70;

		document.getElementById('lowRange').setAttribute('min', 0);
		document.getElementById('lowRange').setAttribute('max', 180);
		document.getElementById('lowRange').setAttribute('step', 70);
		document.getElementById('lowRange').setAttribute('value', 1);
		document.getElementById('lowRange').value = 70;

       
        curve_f = regular;
        updateData();
        delayedUpdateData_total();
    } else if (name == 'imm_injury') {
		document.getElementById('lowNumber').style.visibility = 'visible';
		document.getElementById('lowRange').style.visibility = 'visible';
        document.getElementById('t0Number').style.visibility = 'visible';
        document.getElementById('t0Range').style.visibility = 'visible';
        document.getElementById('t1Number').style.visibility = 'visible';
        document.getElementById('t1Range').style.visibility = 'visible';
        document.getElementById('lowLabel').style.visibility = 'visible';
        document.getElementById('t0Container').style.visibility = 'visible';
        document.getElementById('t1Container').style.visibility = 'visible';
 
        document.getElementById('lowLabel').innerHTML = 'value at time=t2:'; 
   
		document.getElementById('lowNumber').setAttribute('min', 0);
		document.getElementById('lowNumber').setAttribute('max', 180);
		document.getElementById('lowNumber').setAttribute('step', 70);
		document.getElementById('lowNumber').setAttribute('value', 1);
		document.getElementById('lowNumber').value = 70;

		document.getElementById('lowRange').setAttribute('min', 0);
		document.getElementById('lowRange').setAttribute('max', 180);
		document.getElementById('lowRange').setAttribute('step', 70);
		document.getElementById('lowRange').setAttribute('value', 1);
		document.getElementById('lowRange').value = 70;


     
        curve_f = imm_injury;
		updateData();
		delayedUpdateData_total();
    } else if (name == 'variable') {
		document.getElementById('lowNumber').style.visibility = 'visible';
		document.getElementById('lowRange').style.visibility = 'visible';
        document.getElementById('t0Number').style.visibility = 'hidden';
        document.getElementById('t0Range').style.visibility = 'hidden';
        document.getElementById('t1Number').style.visibility = 'hidden';
        document.getElementById('t1Range').style.visibility = 'hidden';
        document.getElementById('lowLabel').style.visibility = 'visible';
        document.getElementById('t0Container').style.visibility = 'hidden';
        document.getElementById('t1Container').style.visibility = 'hidden';
        
        document.getElementById('lowLabel').innerHTML = 'scale:'; 


		document.getElementById('lowNumber').setAttribute('min', 1);
		document.getElementById('lowNumber').setAttribute('max', 4);
		document.getElementById('lowNumber').setAttribute('step', 0.05);
		document.getElementById('lowNumber').setAttribute('value', 1);
		document.getElementById('lowNumber').value = 1;

		document.getElementById('lowRange').setAttribute('min', 1);
		document.getElementById('lowRange').setAttribute('max', 4);
		document.getElementById('lowRange').setAttribute('step', 0.05);
		document.getElementById('lowRange').setAttribute('value', 1);
		document.getElementById('lowRange').value = 1;


        curve_f = var_curve;
		updateData();
		delayedUpdateData_total();
    }

  }
  

  </script>


    <script>
  	
  	function set_met(name, e, t) {
    	document.getElementById(name + t + '-met').value = e.value;
        updateData_met();
        delayedUpdateData_total();
    }
    
 
  var curve_f_met = regular;
  
  function changeCurve_met(name) {
  	if (name == "regular") {
    	document.getElementById('lowNumber-met').style.visibility = 'hidden';
    	document.getElementById('lowRange-met').style.visibility = 'hidden';
        document.getElementById('t0Number-met').style.visibility = 'hidden';
        document.getElementById('t0Range-met').style.visibility = 'hidden';
        document.getElementById('t1Number-met').style.visibility = 'hidden';
        document.getElementById('t1Range-met').style.visibility = 'hidden';
        document.getElementById('lowLabel-met').style.visibility = 'hidden';
        document.getElementById('t0Container-met').style.visibility = 'hidden';
        document.getElementById('t1Container-met').style.visibility = 'hidden';
        
        curve_f_met = regular;
        updateData_met();
        delayedUpdateData_total();
    } else if (name == 'imm_injury') {
    	document.getElementById('lowNumber-met').style.visibility = 'visible';
    	document.getElementById('lowRange-met').style.visibility = 'visible';
        document.getElementById('t0Number-met').style.visibility = 'visible';
        document.getElementById('t0Range-met').style.visibility = 'visible';
        document.getElementById('t1Number-met').style.visibility = 'visible';
        document.getElementById('t1Range-met').style.visibility = 'visible';
        document.getElementById('lowLabel-met').style.visibility = 'visible';
        document.getElementById('t0Container-met').style.visibility = 'visible';
        document.getElementById('t1Container-met').style.visibility = 'visible';
        
        curve_f_met = imm_injury;
    	updateData_met();
        delayedUpdateData_total();
    } else if (name  == 'variable'){
		document.getElementById('lowNumber-met').style.visibility = 'visible';
		document.getElementById('lowRange-met').style.visibility = 'visible';
        document.getElementById('t0Number-met').style.visibility = 'hidden';
        document.getElementById('t0Range-met').style.visibility = 'hidden';
        document.getElementById('t1Number-met').style.visibility = 'hidden';
        document.getElementById('t1Range-met').style.visibility = 'hidden';
        document.getElementById('lowLabel-met').style.visibility = 'visible';
        document.getElementById('t0Container-met').style.visibility = 'hidden';
        document.getElementById('t1Container-met').style.visibility = 'hidden';
        
        document.getElementById('lowLabel-met').innerHTML = 'scale:'; 


		document.getElementById('lowNumber-met').setAttribute('min', 1);
		document.getElementById('lowNumber-met').setAttribute('max', 4);
		document.getElementById('lowNumber-met').setAttribute('step', 0.05);
		document.getElementById('lowNumber-met').setAttribute('value', 1);
		document.getElementById('lowNumber-met').value = 1;

		document.getElementById('lowRange-met').setAttribute('min', 1);
		document.getElementById('lowRange-met').setAttribute('max', 4);
		document.getElementById('lowRange-met').setAttribute('step', 0.05);
		document.getElementById('lowRange-met').setAttribute('value', 1);
		document.getElementById('lowRange-met').value = 1;


        curve_f_met = var_curve;
		updateData_met();
		delayedUpdateData_total();
 
	}
  }
  
  function setDefautDoseTd() {
        document.getElementById("doseNumber").value = 40;
        document.getElementById("doseRange").value = 40;

        document.getElementById("TdNumber").value = 4;
        document.getElementById("TdRange").value = 4;
    
  }
  
  function setChangeCheckbox(parameter, value) {
        let el = document.getElementById(parameter + "Change");
        
        el.checked = value;
        toggleChangeFieldset(el);
  }
  
  
  function changeScenario(name) {
    setDefautDoseTd();
  
    if (name=="sc_maintenance") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;
        
        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;
 
        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

		document.getElementById('curveType').value = 'regular';    
        changeCurve("regular"); 

        updateData();
        updateData_total();
    } else if (name=="sc_compromised_start") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.07;
        document.getElementById("keRange").value = 0.07;

        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;

        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

		document.getElementById('curveType').value = 'regular'; 
        changeCurve("regular"); 

       
        updateData();
        updateData_total();
    } else if (name=="sc_compromised_during") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;

        //document.getElementById("keChange").checked = true;
        document.getElementById("keChangeTimeNumber").value = 40;
        document.getElementById("keChangeTimeRange").value = 40;
        document.getElementById("keChangeValueNumber").value = 0.05;
        document.getElementById("keChangeValueRange").value = 0.05;

        setChangeCheckbox("ke", true)



        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;
        
        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

        document.getElementById("curveType").value = "regular";
		changeCurve("regular"); 


        updateData();
        updateData_total();

    } else if (name=="sc_maintenance_met") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;

        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = true;

		toggleMetaboliteBoxes();        

		// metabolite
        document.getElementById("vmaxNumber").value = 100;
        document.getElementById("vmaxRange").value = 100;

        document.getElementById("kmNumber").value = 1000;
        document.getElementById("kmRange").value = 1000;

        document.getElementById("ke_metNumber").value = 0.5;
        document.getElementById("ke_metRange").value = 0.5;





        
        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

        document.getElementById("curveType").value = "regular";
        document.getElementById("curveType-met").value = "regular";
        changeCurve("regular"); 
        changeCurve_met('regular');
        document.getElementById("highNumber-met").value = 20;
        document.getElementById("highRange-met").value = 20;

       
        updateData();
        updateData_met();
        updateData_total();

    } else if (name=="sc_compromised_during_met") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;

        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = true;
   
		toggleMetaboliteBoxes();        
		// metabolite
        document.getElementById("vmaxNumber").value = 100;
        document.getElementById("vmaxRange").value = 100;

        document.getElementById("kmNumber").value = 1000;
        document.getElementById("kmRange").value = 1000;

        document.getElementById("ke_metNumber").value = 0.15;
        document.getElementById("ke_metRange").value = 0.15;


         
        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

        document.getElementById("curveType").value = "regular";
        
        document.getElementById("curveType-met").value = "regular";
        changeCurve("regular"); 
        changeCurve_met('regular');
        document.getElementById("highNumber-met").value = 20;
        document.getElementById("highRange-met").value = 20;

       
        updateData();
        updateData_met();
        updateData_total();
    } else if (name=="sc_zero_order") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0;
        document.getElementById("keRange").value = 0;

        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)

        document.getElementById("ke_metNumber").value = 0.15;
        document.getElementById("ke_metRange").value = 0.15;

        //document.getElementById("keChange").checked = false;


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;
        
        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

        document.getElementById("curveType").value = "regular";
        
        document.getElementById("curveType-met").value = "regular";
        changeCurve("regular"); 
        changeCurve_met('regular');
        document.getElementById("highNumber-met").value = 20;
        document.getElementById("highRange-met").value = 20;

       
        updateData();
        updateData_met();
        updateData_total();
    } else if (name=="sc_reduced_tox_threshold") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;

        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)

        document.getElementById("ke_metNumber").value = 0.15;
        document.getElementById("ke_metRange").value = 0.15;

        //document.getElementById("keChange").checked = false;


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;
        
        document.getElementById("highNumber").value = 94;
        document.getElementById("highRange").value = 94;

        document.getElementById("curveType").value = "regular";
        
        document.getElementById("curveType-met").value = "regular";

        changeCurve("regular"); 
        changeCurve_met('regular');
        document.getElementById("highNumber-met").value = 20;
        document.getElementById("highRange-met").value = 20;

       
        updateData();
        updateData_met();
        updateData_total();
    } else if (name=="sc_variable_tox_threshold") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;
        
        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;
 
        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

		document.getElementById('curveType').value = 'variable';
        changeCurve("variable"); 

        updateData();
        updateData_total();
 
	}else if (name=="sc_immune_injury") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;

        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)

        document.getElementById("ke_metNumber").value = 0.15;
        document.getElementById("ke_metRange").value = 0.15;

        //document.getElementById("keChange").checked = false;


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;
        

		document.getElementById('curveType').value='imm_injury';
        changeCurve('imm_injury');
        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

        document.getElementById("lowNumber").value = 84;
        document.getElementById("lowRange").value = 84;

        document.getElementById("t0Number").value = 40;
        document.getElementById("t0Range").value = 40;

        document.getElementById("t1Number").value = 42;
        document.getElementById("t1Range").value = 42;


        //document.getElementById("curveType").value = "regular";
        

        document.getElementById("curveType-met").value = "regular";

        changeCurve_met('regular');
        document.getElementById("highNumber-met").value = 20;
        document.getElementById("highRange-met").value = 20;

       
        updateData();
        updateData_met();
        updateData_total();
    } else if (name=="sc_mito_injury") {
        document.getElementById("kaNumber").value = 1;
        document.getElementById("kaRange").value = 1;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;

        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)

        document.getElementById("ke_metNumber").value = 0.15;
        document.getElementById("ke_metRange").value = 0.15;

        //document.getElementById("keChange").checked = false;


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;
        

		document.getElementById('curveType').value = 'imm_injury';
        changeCurve('imm_injury');
        document.getElementById("highNumber").value = 144;
        document.getElementById("highRange").value = 144;

        document.getElementById("lowNumber").value = 84;
        document.getElementById("lowRange").value = 84;

        document.getElementById("t0Number").value = 40;
        document.getElementById("t0Range").value = 40;

        document.getElementById("t1Number").value = 80;
        document.getElementById("t1Range").value = 80;


        

        document.getElementById("curveType-met").value = "regular";

        changeCurve_met('regular');
        document.getElementById("highNumber-met").value = 20;
        document.getElementById("highRange-met").value = 20;

       
        updateData();
        updateData_met();
        updateData_total();
    } else if (name=="sc_failure_adapt"){
        document.getElementById("kaNumber").value = 2;
        document.getElementById("kaRange").value = 2;

        document.getElementById("keNumber").value = 0.1;
        document.getElementById("keRange").value = 0.1;
        
        //document.getElementById("keChange").checked = false;
        setChangeCheckbox("ke", false)


        document.getElementById("FNumber").value = 1;
        document.getElementById("FRange").value = 1;

        document.getElementById("VdNumber").value = 1;
        document.getElementById("VdRange").value = 1;

        document.getElementById("showMetabolite").checked = false;
 
        document.getElementById("highNumber").value = 105;
        document.getElementById("highRange").value = 105;

		document.getElementById('curveType').value = 'adaptation';    
        changeCurve("adaptation"); 

        updateData();
        updateData_total();
 
	} else if (name=="custom") {
		// noop
    }
 
 
  }
</script>
<div class="container">
    <h1>DemoTox-PK <a class="noprint" href="about.html" style="font-size: 16px;">documentation</a></h1>
  
  <button class="noprint" onclick="window.print();">Print</button>
  
  <canvas id="totalChart"></canvas>

  <div class="noprint" style="overflow-y: auto; max-height: 500px;">




  <button class="accordion">IDILI hypotheses</button>
  <div class="accordion-content">
    <p>
	<form>
    <label id="hypoLabel" style="float: left; width: 120px;">scenario: </label><select id="idiliScenarios" onchange="changeScenario(this.value);">
      <option value="sc_maintenance" selected>Therapeutic drug maintenance</option>
      <option value="sc_compromised_start" >Compromised drug kinetics at onset</option>
      <option value="sc_compromised_during" >Compromised drug kinetics during therapy</option>

      <option value="sc_maintenance_met">Therapeutic drug maintenance - metabolite</option>
      <option value="sc_compromised_during_met" >Compromised metabolite kinetics at onset</option>
	  <option value="sc_zero_order">Zero-order kinetics</option>
	  <option value="sc_reduced_tox_threshold">Reduced toxicity threshold</option>
	  <option value="sc_variable_tox_threshold">Varible toxicity threshold</option>
	  <option value="sc_immune_injury">Adaptive immune response</option>
	  <option value="sc_mito_injury">Slowly developing injury (e.g., mitochondrial)</option>
	  <option value="sc_failure_adapt">Failure to adapt</option>

      <option value="sc_custom">custom</option>
    </select><br />
    
		
    </form> 
       </p>
  </div>





  
  <button class="accordion">Model parameters</button>
  <div class="accordion-content">
    <p>
	<form>
        <label id="ymaxLabel" style="float: left; width: 90px;">y max: </label><input id="ymaxRange" type="range" name="amountRange" min="10" max="550" value="180" step="1" oninput="set('ymax', this, 'Number');" />
        <input id="ymaxNumber" type="number" name="amountInput" min="10" max="550" value="180" step="1" oninput="set('ymax', this, 'Range');" />
    <br />        
    
    
        <label id="doseLabel" style="float: left; width: 90px;">Dose: </label><input id="doseRange" type="range" name="amountRange" min="10" max="55" value="40" step="1" oninput="set('dose', this, 'Number');" />
		<input id="doseNumber" type="number" name="amountInput" min="10" max="55" value="40" step="1" oninput="set('dose', this, 'Range');" />
    <br />
    
    <label id="isIVLabel" style="float: left; width: 90px;">IV dose? </label><div id="div-isivdose"><input type="checkbox" id="isIVDose" name="isIVDose" onclick="setisIVDose();"></div>
    <br /><br />
    
    <label id="singleDoseLabel" style="float: left; width: 90px;">single dose? </label><div id="div-dose1"><input type="checkbox" id="singleDose" name="singleDose" onclick="setSingleDose();"></div>
    <br />
    
    <fieldset id="doses">
        <legend>Individual doses</legend>
        <div class="contflex space-around">
            <div id="div-dose1"><input type="checkbox" id="dose1" name="dose1" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose2"><input type="checkbox" id="dose2" name="dose2" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose3"><input type="checkbox" id="dose3" name="dose3" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose4"><input type="checkbox" id="dose4" name="dose4" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose5"><input type="checkbox" id="dose5" name="dose5" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose6"><input type="checkbox" id="dose6" name="dose6" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose7"><input type="checkbox" id="dose7" name="dose7" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose8"><input type="checkbox" id="dose8" name="dose8" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose9"><input type="checkbox" id="dose9" name="dose9" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose10"><input type="checkbox" id="dose10" name="dose10" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose11"><input type="checkbox" id="dose11" name="dose11" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose12"><input type="checkbox" id="dose12" name="dose12" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose13"><input type="checkbox" id="dose13" name="dose13" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose14"><input type="checkbox" id="dose14" name="dose14" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose15"><input type="checkbox" id="dose15" name="dose15" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose16"><input type="checkbox" id="dose16" name="dose16" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose17"><input type="checkbox" id="dose17" name="dose17" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose18"><input type="checkbox" id="dose18" name="dose18" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose19"><input type="checkbox" id="dose19" name="dose19" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose20"><input type="checkbox" id="dose20" name="dose20" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose21"><input type="checkbox" id="dose21" name="dose21" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose22"><input type="checkbox" id="dose22" name="dose22" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose23"><input type="checkbox" id="dose23" name="dose23" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose24"><input type="checkbox" id="dose24" name="dose24" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose25"><input type="checkbox" id="dose25" name="dose25" checked onclick="delayedUpdateData_total();"></div>
            <div id="div-dose26"><input type="checkbox" id="dose26" name="dose26" checked onclick="delayedUpdateData_total();"></div>
        </div>
    </fieldset>
    
        <label id="TdLabel" style="float: left; width: 90px;">Td: </label><input id="TdRange" type="range" name="amountRange" min="2" max="12" value="4" step="1" oninput="set('Td', this, 'Number');" />
		<input id="TdNumber" type="number" name="amountInput" min="2" max="12" value="4" step="1" oninput="set('Td', this, 'Range');" />
    <br />

        
		<label id="kaLabel" style="float: left; width: 90px;">ka: </label><input id="kaRange" type="range" name="amountRange" min="0" max="3" value="1" step="0.1" oninput="set('ka', this, 'Number');" />
		<input id="kaNumber" type="number" name="amountInput" min="0" max="3" value="1" step="0.1" oninput="set('ka', this, 'Range');" />
    <br />

		<label id="keLabel" style="float: left; width: 90px;">ke1: </label><input id="keRange" type="range" name="amountRange" min="0" max="1" value="0.1" step="0.01" oninput="set('ke', this, 'Number');" />
		<input id="keNumber" type="number" name="amountInput" min="0" max="1" value="0.1" step="0.01" oninput="set('ke', this, 'Range');" />
        <label id"keChangeLabel">change: </label>
        <input id="keChange" type="checkbox" onclick="changeKe(this);" />
    <br />
        
    <fieldset id="keChangeFieldset" disabled>
        <label id="keChangeTimeLabel" style="float: left; width: 90px;">at time</label><input id="keChangeTimeRange" type="range" name="amountRange" min="0" max="80" value="40" step="1" oninput="set('keChangeTime', this, 'Number');" />
		<input id="keChangeTimeNumber" type="number" name="amountInput" min="0" max="80" value="40" step="1" oninput="set('keChangeTime', this, 'Range');" />
    <br />

		<label id="keChangeValueLabel" style="float: left; width: 90px;">value</label><input id="keChangeValueRange" type="range" name="amountRange" min="0" max="1" value="0.05" step="0.01" oninput="set('keChangeValue', this, 'Number');" />
		<input id="keChangeValueNumber" type="number" name="amountInput" min="0" max="1" value="0.05" step="0.01" oninput="set('keChangeValue', this, 'Range');" />

    <br />
    </fieldset>
    
		<label id="FLabel" style="float: left; width: 90px;">F: </label><input id="FRange" type="range" name="amountRange" min="0.05" max="1" value="1" step="0.05" oninput="set('F', this, 'Number');" />
		<input id="FNumber" type="number" name="amountInput" min="0.05" max="1" value="1" step="0.05" oninput="set('F', this, 'Range');" />
    <br />

		<label id="VdLabel" style="float: left; width: 90px;">Vd: </label><input id="VdRange" type="range" name="amountRange" min="1" max="60" value="1" step="1" oninput="set('Vd', this, 'Number');" />
		<input id="VdNumber" type="number" name="amountInput" min="1" max="60" value="1" step="1" oninput="set('Vd', this, 'Range');" />
    <br />


    <br /><br /><hr />
    
        <label id="labelShowMetabolite" style="float: left;">Metabolism: </label><input type="checkbox" id="showMetabolite" name="showMetabolite" onclick="delayedUpdateData_total();toggleMetaboliteBoxes();" />
        <br/><br/>
    
        <label id="vmaxLabel" style="float: left; width: 90px;">Vmax: </label><input id="vmaxRange" type="range" name="amountRange" min="50" max="150" value="100" step="10" oninput="set('vmax', this, 'Number');" disabled/>
		<input id="vmaxNumber" type="number" name="amountInput" min="50" max="150" value="100" step="10" oninput="set('vmax', this, 'Range');" disabled />
   <br />
        
        
        <label id="kmLabel" style="float: left; width: 90px;">Km: </label><input id="kmRange" type="range" name="amountRange" min="500" max="1500" value="1000" step="100" oninput="set('km', this, 'Number');" disabled />
		<input id="kmNumber" type="number" name="amountInput" min="500" max="1500" value="1000" step="100" oninput="set('km', this, 'Range');" disabled />
   <br />

        <label id="ke_metLabel" style="float: left; width: 90px;">ke2: </label><input id="ke_metRange" type="range" name="amountRange" min="0" max="3" value="0.5" step="0.1" oninput="set('ke_met', this, 'Number');" disabled />
		<input id="ke_metNumber" type="number" name="amountInput" min="0" max="3" value="0.5" step="0.1" oninput="set('ke_met', this, 'Range');" disabled />
    <br />
  


    </form> 
       </p>
  </div>




  <button class="accordion">Efficacy threshold</button>
  <div class="accordion-content">
    <p>
	<form>
        <label id="labelShowEfficacy" style="float: left;">Show efficacy threshold: </label><input type="checkbox" id="showEfficacy" name="showEfficacy" onclick="delayedUpdateData_total();" />
        <br/><br/>
    
		<label id="efficacyLabel" style="float: left; width: 150px;">value: </label>

		<input id="efficacyRange" type="range" name="amountRange" min="0" max="180" value="80" step="1" oninput="set('efficacy', this, 'Number');" />
		<input id="efficacyNumber" type="number" name="amountInput" min="0" max="180" value="80" step="1" oninput="set('efficacy', this, 'Range');" />
	</form>
  

    </p>
  </div>



  <button class="accordion">Drug toxicity threshold</button>
  <div class="accordion-content">
    <p>
	<form>
    <label id="curveTypeLabel" style="float: left; width: 150px;">curve type: </label>
    
    <select id="curveType" onchange="changeCurve(this.value);">
      <option value="regular" selected>constant threshold</option>
      <option value="imm_injury">change in threshold</option>
      <option value="variable">variable threshold</option>
      <option value="adaptation">adaptation threshold</option>
 
    </select><br /><br />
    
		<label id="highLabel" style="float: left; width: 150px;">value at time=0: </label>

		<input id="highRange" type="range" name="amountRange" min="0" max="180" value="144" step="1" oninput="set('high', this, 'Number');" />
		<input id="highNumber" type="number" name="amountInput" min="0" max="180" value="144" step="1" oninput="set('high', this, 'Range');" />
    	<br />
		<br />
    
    
    <label id="lowLabel" style="float: left; width: 150px;">value at time=t2: </label><input id="lowRange" type="range" name="amountRange" min="0" max="180" value="70" step="1" oninput="set('low', this, 'Number');" />
		<input id="lowNumber" type="number" name="amountInput" min="0" max="180" value="70" step="1" oninput="set('low', this, 'Range');" />
    <br /><br />



    <div id="t0Container" style="position: relative; width: 80px;"> 
    
    	<label id="t0Label" style="float: left; width: 150px;">t1: </label>
		<div class="help-tip">
			<p>onset of threshold change</p>
		</div>
	</div>		
	<input id="t0Range" type="range" name="amountRange" min="0" max="240" value="3" step="1" oninput="set('t0', this, 'Number');" />
	<input id="t0Number" type="number" name="amountInput" min="0" max="240" value="40" step="1" oninput="set('t0', this, 'Range');" />
    <br />
    


   	<div id="t1Container" style="position: relative; width: 80px;"> 
    	<label id="t1Label" style="float: left; width: 150px;">t2:</label> 
		<div class="help-tip">
			<p>time to achieve second threshold (slope of change)</p>
		</div>
	</div>
	<input id="t1Range" type="range" name="amountRange" min="0" max="240" value="80" step="1" oninput="set('t1', this, 'Number');" />
	<input id="t1Number" type="number" name="amountInput" min="0" max="240" value="80" step="1" oninput="set('t1', this, 'Range');" />


	</form>
  
  <!--<div style="width:390px;">
    <canvas id="myChart"></canvas>
  </div>-->

    </p>
  </div>

  <button class="accordion">Drug metabolite toxicity threshold</button>
  <div class="accordion-content">
    <p>
	<form>
    <label id="highLabel-met" style="float: left; width: 150px;">curve type: </label>

	<select id="curveType-met" onchange="changeCurve_met(this.value);">
      <option value="regular" selected>constant threshold</option>
      <option value="imm_injury">change in threshold</option>
      <option value="variable">variable threshold</option> 
    </select><br /><br />
    
		<label id="highLabel-met" style="float: left; width: 150px;">value at time=0: </label><input id="highRange-met" type="range" name="amountRange" min="0" max="180" value="30" step="1" oninput="set_met('high', this, 'Number');" />
		<input id="highNumber-met" type="number" name="amountInput" min="0" max="180" value="30" step="1" oninput="set_met('high', this, 'Range');" />
    <br /><br />
    
    
    <label id="lowLabel-met" style="float: left; width: 150px;">value at time=t2: </label><input id="lowRange-met" type="range" name="amountRange" min="0" max="180" value="10" step="1" oninput="set_met('low', this, 'Number');" />
		<input id="lowNumber-met" type="number" name="amountInput" min="0" max="180" value="10" step="1" oninput="set_met('low', this, 'Range');" />
    <br /><br />
   
	<div id="t0Container-met" style="position: relative; width: 80px;">
 
    	<label id="t0Label-met" style="float: left; width: 150px;">t1: </label>
		<div class="help-tip">
			<p>onset of threshold change</p>
		</div>
	</div>
		
	<input id="t0Range-met" type="range" name="amountRange" min="0" max="240" value="20" step="1" oninput="set_met('t0', this, 'Number');" />
	<input id="t0Number-met" type="number" name="amountInput" min="0" max="240" value="20" step="1" oninput="set_met('t0', this, 'Range');" />
    <br />
    
    <div id="t1Container-met" style="position: relative; width: 80px;">

    	<label id="t1Label-met" style="float: left; width: 150px;">t2: </label>
		<div class="help-tip">
			<p>time to achieve second threshold (slope of change)</p>
		</div>
	</div>


<input id="t1Range-met" type="range" name="amountRange" min="0" max="240" value="30" step="1" oninput="set_met('t1', this, 'Number');" />
		<input id="t1Number-met" type="number" name="amountInput" min="0" max="240" value="30" step="1" oninput="set_met('t1', this, 'Range');" />
	</form>
  
  <!--<div style="width:390px;">
    <canvas id="myChart-met"></canvas>
  </div>-->


    </p>
  </div>
  <button class="accordion">Contact and citation information</button>
  <div class="accordion-content">
    <p>A related review paper has been accepted for publication and the citation information will appear below once available.</p>
    <p>For questions about the DemoTox-Pk software contact</p>
    <p style="padding-left:30px;">David Filipovic &lt;<a href="mailto:filipov4@msu.edu">filipov4@msu.edu</a>&gt; <br/> Omar Kana &lt;<a href="mailto:kanaomar@msu.edu">kanaomar@msu.edu</a>&gt;</p>
    <p>For questions about IDILI or IDILI hypotheses contact</p>
    <p style="padding-left:30px;">Robert Roth &lt;<a href="mailto:rothr@msu.edu">rothr@msu.edu</a>&gt; <br/> Patricia Ganey &lt;<a href="mailto:ganey@msu.edu">ganey@msu.edu</a>&gt;</p>
  </div>
  </div>

</div>
  <script>
    noPoints = 400;
    step = 0.2;

  	function makeData() {
      var labels = [];
      var data = [];

      for (var i=0; i < noPoints; i++) {
          labels.push(i*step);
      }


      var h = document.getElementById('highNumber').value;
      var l = document.getElementById('lowNumber').value;
      var t0 = document.getElementById('t0Number').value;
      var t1 = document.getElementById('t1Number').value;

      for (var i=0; i < noPoints; i++) {
        data.push( curve_f(i*step, h, l, t0, t1) );
      }
      return [labels, data]
    }
 
  	function makeDataAdaptation() {
      var labels = [];
      var data = [];

      for (var i=0; i < noPoints; i++) {
          labels.push(i*step);
      }


      var h = document.getElementById('highNumber').value;
      var l = document.getElementById('lowNumber').value;
      var t0 = document.getElementById('t0Number').value;
      var t1 = document.getElementById('t1Number').value;

      for (var i=0; i < noPoints; i++) {
        data.push( adapted_curve(i*step, h, l, t0, t1) );
      }
      return [labels, data]
    }
    
    function updateData() {
    		var data = makeData()[1];
        
        //myChart.data.datasets[0].data = data;
        //myChart.update();
    }
    //const ctx = document.getElementById('myChart').getContext('2d');
    var mData = makeData();

    
    
    /*const myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: mData[0],
        datasets: [{
            label: 'toxicity threshold',
            data: mData[1],
            borderColor: "#FF0000",
      		backgroundColor: "#FF0000",
            borderDash: [5,5]
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true,
                max: 180
            }
        },
        radius: 0
    }
});*/</script>

   <script>
  	function makeData_met() {
      var labels = [];
      var data = [];

      for (var i=0; i < noPoints; i++) {
          labels.push(i*step);
      }


      var h = document.getElementById('highNumber-met').value;
      var l = document.getElementById('lowNumber-met').value;
      var t0 = document.getElementById('t0Number-met').value;
      var t1 = document.getElementById('t1Number-met').value;

      for (var i=0; i < noPoints; i++) {
        data.push( curve_f_met(i*step, h, l, t0, t1) );
      }
      return [labels, data]
    }
    
    
    
    function makeData_eff() {
      var labels = [];
      var data = [];

      for (var i=0; i < noPoints; i++) {
          labels.push(i*step);
      }


      var h = document.getElementById('efficacyNumber').value;

      for (var i=0; i < noPoints; i++) {
        data.push( curve_f_met(i*step, h, h, 0, 0) );
      }
      return [labels, data]
    }
    
    function updateData_met() {
    		var data = makeData_met()[1];
        
        //myChart_met.data.datasets[0].data = data;
        //myChart_met.update();
    }
    //const ctx_met = document.getElementById('myChart-met').getContext('2d');
    var mData = makeData_met();

    
    
    /*const myChart_met = new Chart(ctx_met, {
    type: 'line',
    data: {
        labels: mData[0],
        datasets: [{
            label: 'metabolite toxicity threshold',
            data: mData[1],
            borderColor: "#0000FF",
      		backgroundColor: "#0000FF",
            borderDash: [5,5]
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true,
                max: 180
            }
        },
        radius: 0
    }
});*/</script>


   <script>
    const ctx_total = document.getElementById('totalChart').getContext('2d');
    timeout_Total = 0;
    
    function toggleChangeFieldset(el) {        
        let checked = el.checked;
        let name = el.id.slice(0, el.id.length-6);
        
        if (checked) {
            document.getElementById(name + 'ChangeFieldset').removeAttribute('disabled');
        } else {
            document.getElementById(name + 'ChangeFieldset').setAttribute('disabled', true);
        }
    }

    function toggleMetaboliteBoxes() {
        var showMet = document.getElementById('showMetabolite').checked;

        if (!showMet) {
            document.getElementById('vmaxRange').setAttribute('disabled', true);
            document.getElementById('vmaxNumber').setAttribute('disabled', true);
            document.getElementById('kmRange').setAttribute('disabled', true);
            document.getElementById('kmNumber').setAttribute('disabled', true);
            document.getElementById('ke_metRange').setAttribute('disabled', true);
            document.getElementById('ke_metNumber').setAttribute('disabled', true);
 
        } else {
            document.getElementById('vmaxRange').removeAttribute('disabled');
            document.getElementById('vmaxNumber').removeAttribute('disabled');
            document.getElementById('kmRange').removeAttribute('disabled');
            document.getElementById('kmNumber').removeAttribute('disabled');
            document.getElementById('ke_metRange').removeAttribute('disabled');
            document.getElementById('ke_metNumber').removeAttribute('disabled');
 
        }
    }

    function delayedUpdateData_total() {
        clearTimeout(timeout_Total);
        timeout_Total = setTimeout(updateData_total, 100);
    }
    
    function setSingleDose() {
        let el = document.getElementById('singleDose');
        let setTo = true;
        
        if (el.checked) {
            document.getElementById('dose1').checked = true;
            setTo = false;
        }
        
        for (i=2; i<27; i++) {
            document.getElementById('dose' + i).checked = setTo;
        }
        delayedUpdateData_total();
    }
    
    function setisIVDose() {
        let el = document.getElementById('isIVDose');
        isIVDose = el.checked;
        
        delayedUpdateData_total();
    }

    function updateData_total() {
        var el = document.getElementById('keChange');

        ymax = document.getElementById('ymaxNumber').valueAsNumber;

        Dose = document.getElementById('doseNumber').valueAsNumber;
        Td = document.getElementById('TdNumber').valueAsNumber;
        
        for (i=1; i<27; i++) {
            if (i < (Math.floor(80/Td) + 1)) {
                document.getElementById('div-dose' + i).style.display = 'flex';
            } else {
                document.getElementById('div-dose' + i).style.display = 'none';
            }
        }

        ka = document.getElementById('kaNumber').value;
          if (el.checked) {
              let tChange = document.getElementById('keChangeTimeNumber').valueAsNumber;
              let valChange = document.getElementById('keChangeValueNumber').valueAsNumber;
              
              ke = function(t) {
                  if (t<tChange) {
                      return document.getElementById('keNumber').value;
                  } else {
                      return valChange;
                  }
              }
          } else {
              ke = function(t) {return document.getElementById('keNumber').value;}
          }
        F = document.getElementById('FNumber').valueAsNumber;
        Vd = document.getElementById('VdNumber').valueAsNumber;
        
        Vmax = document.getElementById('vmaxNumber').valueAsNumber;
        km = document.getElementById('kmNumber').valueAsNumber;
        ke_m = document.getElementById('ke_metNumber').valueAsNumber;
         
     
       // ke = function(t) {return document.getElementById('keNumber').value;}

    	var data = makeData();
        var data_met = makeData_met();
        var data_eff = makeData_eff();
		var data_branch = makeDataAdaptation();
        
        myChart_total.options.scales.y.max = ymax;
        
        myChart_total.data.datasets[0].data = data[1];
        if (document.getElementById('showMetabolite').checked) {
            myChart_total.data.datasets[1].data = data_met[1];
            myChart_total.data.datasets[3].data = solve()[1];
        } else {
            Vmax = 0;
            myChart_total.data.datasets[1].data = []; 
            myChart_total.data.datasets[3].data = [];
        }


        if (document.getElementById('showEfficacy').checked) {
            myChart_total.data.datasets[4].data = data_eff[1];
        } else {
            myChart_total.data.datasets[4].data = []; 
        }
        
        
		if (document.getElementById('curveType').value == 'adaptation') {
			if (myChart_total.data.datasets.length == 5) {	
				myChart_total.data.datasets[5] = {label: 'adapted toxicity threshold', data: [], borderColor: '#00FF00', backgroundColor: '#00FF00', borderDash: [5,2]};
			}
			myChart_total.data.datasets[5].data = data_branch[1];
		} else {
			if (myChart_total.data.datasets.length == 6) {
				myChart_total.data.datasets.pop();
			}
		}

        myChart_total.data.datasets[2].data = solve()[0];
        
        myChart_total.update();
    }
    	var data = makeData();
        var data_met = makeData_met();
   
    
    const myChart_total = new Chart(ctx_total, {
    type: 'line',
    data: {
        labels: data[0],
        datasets: [
            {label: "toxicity threshold", data: [], borderColor: "#FF0000", backgroundColor: "#FFFFFF", borderDash: [5,2]},
            {label: "metabolite toxicity threshold", data: [], borderColor: "#7F00FF", backgroundColor: "#FFFFFF", borderDash: [5,2]},
            {label: "drug concentration", data: [], borderColor: "#000000", backgroundColor: "#000000", borderDash: [0,0]},
            {label: "metabolite concentration", data: [], borderColor: "#0000FF", backgroundColor: "#0000FF", borderDash: [0,0]},
            {label: "efficacy threshold", data: [], borderColor: "#00AA00", backgroundColor: "#FFFFFF", borderDash: [5,2]}
 
        ]
    },
    options: {
        plugins: {
            legend: {
                labels: {
                        color: '#000000',
                        font: {
                            size: 28,
                            weight: 400
                        },
                        //usePointStyle: true,
                        //pointStyle: 'cirle',
                        boxHeight: 2,
		                filter: function(item, chart) {
        		            // Logic to remove a particular legend item goes here
                		    return !item.text.includes('adapted');
						}
     
                },
				align: 'end',
           }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 180,
                ticks: {
                        color: '#000000',
                        font: {
                            size: 30,
                            weight: 600
                        }
                },
                grid: {
                    borderWidth: 3,
                    borderColor: '#000000',
                    display: false,
                },

                title: {
                    display: true,
                    text: 'Concentration',
                    color: '#000000',
                    font: {
                        size: 30,
                        weight: 'bold',
                        lineHeight: 1.2,
                    }
                }
             },
             x: {
                grid: {
                    borderWidth: 3,
                    borderColor: '#000000',
                    display: false
                },
                ticks: {
                        
                        display: false,
                        color: '#000000',
                        font: {
                            size: 30,
                            weight: 600
                        }
                },
		title: {	
		  display: true,
		  text: 'Time',
		  color: '#000000',
		  font: {
		    size: 30,
		    weight: 'bold',
		    lineHeight: 1.2,
		  } // end font
		}  // end title
	      }  // end x
        }, // end scales
        radius: 0
    } // end options
});
  delayedUpdateData_total(); 
   </script>







 
<script>
//pseudocode
/*
  1.Grab the accordion buttons from the DOM
  2. go through each accordion button one by one
  3. Use the classlist dom method in combination with the toggle method provided by the DOM to add or remove the "is-open" class. At this point, the accordion button should be able to switch back and forth between its font awesome icons but there is no content inside of it. This is because of the overflow:hidden and the max-height of zero; it is hiding our content. So now we must use javascript to change these values with DOM CSS
  4. get the div that has the content of the accordion button you are currently looking at; we do this using the .nextElementSibling method which allows us to look at the html element that is directly next to the current html element we are looking at. Since we are currently looking at a button (accordion button), the next element after that is the div with the class accordion-content. This is exactly what we want because it allows us to work with the div that has the content that we want to display. Also please note that we could have got to this div in another way but this is the "shortest path" to our answer.
  
  5. set the max-height based on whether the current value of the max-height css property. If the max-height is currently 0 (if the page has just been visited for the first time) or null (if it has been toggled once already) which means that it is closed, you will give it an actual value so the content will be shown; if not then that means the max-height currently has a value and you can set it back to null to close it.
  6. If the accordion is closed we set the max-height of the currently hidden text inside the accordion from 0 to the scroll height of the content inside the accordion. The scroll height refers to the height of an html element in pixels. For this specific example, we are talking about the height of the div with the class accordion-content with all of its nested ptags
*/

const accordionBtns = document.querySelectorAll(".accordion");

accordionBtns.forEach((accordion) => {
  accordion.onclick = function () {
    this.classList.toggle("is-open");

    let content = this.nextElementSibling;
    console.log(content);

    if (content.style.maxHeight) {
      //this is if the accordion is open
      content.style.maxHeight = null;
    } else {
      //if the accordion is currently closed
      content.style.maxHeight = content.scrollHeight + "px";
      console.log(content.style.maxHeight);
    }
  };
});
</script>
<script>
  changeCurve('regular');
  changeCurve_met('regular');
  function changeKe(el) {
    toggleChangeFieldset(el);
    delayedUpdateData_total(); 
  }
</script>
</body>
